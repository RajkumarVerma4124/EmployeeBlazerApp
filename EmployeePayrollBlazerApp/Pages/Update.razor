@page "/Update/{EmployeeId}"

@using CommonLayer.Models
@using BusinessLayer.Interface
@using System.Threading

@inject IEmployeeRegisterBL employeeBL
@inject NavigationManager navigate

<!--Creating the header element with logo and text using flex and css for homepage(UC14)-->
<header class="header-content header">
    <div class="logo-content">
        <img src="../assets/images/logo.png" alt="Logo" />
        <div class="emp_text">
            <span><a href="HomePage">Employee</a></span><br>
            <span class="emp_text_payroll">Payroll</span>
        </div>
    </div>
</header>

<!--Creating the form element with input name-->
<div class="form-content">
    <form class="form">
        <EditForm Model="@employee">
            <span class="form-head">Employee Payroll Register</span>
            <div class="row-content">
                <label class="label text label-bold" for="empName">Employee Name</label>
                <input type="text" class="input" name="empName" @bind-value="@employee.Name" id="empName" placeholder="Enter Your Name Here..." required>
                <error class="error" id="errorName"></error>
            </div>
            <!--Creating the form element with input type radio to select profile pic-->
            <div class="row-content">
                <label class="label text label-bold" for="profiles">Profile Image</label>
                <div class="profile-radio-content">
                    <label>
                        <input type="checkbox" id="profile1" name="profile" value="./assets/profile-images/Ellipse -1.png" @onchange="@(()=> AddImg("./assets/profile-images/Ellipse -1.png"))" />
                        <img class="profile" , id="img1" src="./assets/profile-images/Ellipse -1.png" />
                    </label>
                    <label>
                        <input type="checkbox" id="profile2" name="profile" value="./assets/profile-images/Ellipse -2.png" @onchange="@(()=> AddImg("./assets/profile-images/Ellipse -2.png"))" />
                        <img class="profile" , id="img2" src="./assets/profile-images/Ellipse -2.png" />
                    </label>
                    <label>
                        <input type="checkbox" id="profile3" name="profile" value="./assets/profile-images/Ellipse -3.png" @onchange="@(()=> AddImg("./assets/profile-images/Ellipse -3.png"))" />
                        <img class="profile" , id="img3" src="./assets/profile-images/Ellipse -3.png" />
                    </label>
                    <label>
                        <input type="checkbox" id="profile4" name="profile" value="./assets/profile-images/Ellipse -4.png" @onchange="@(()=> AddImg("./assets/profile-images/Ellipse -4.png"))" />
                        <img class="profile" , id="img4" src="./assets/profile-images/Ellipse -4.png" />
                    </label>
                </div>
            </div>
            <!--Creating the form element with input type radio to select gender-->
            <div class="row-content">
                <label class="label text label-bold" for="gender">Gender</label>
                <select class="ip" name="gender" id="gender" @bind="@employee.Gender" required>
                    <option value="--">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <!--Creating the form element with input type checkbox to select department-->
            <div class="row-content">
                <label class="label text label-bold" for="department"> Department</label>
                <select class="ip" name="department" id="department" @bind="@employee.Department" required>
                    <option value="--">-- Select Department --</option>
                    <option value="it">Robotics</option>
                    <option value="devops">Devops</option>
                    <option value="Engineer">Web Developer</option>
                    <option value="Finance">Finance</option>
                    <option value="Business">Business</option>
                    <option value="hr">HR</option>
                    <option value="ml">Machine Learning</option>
                </select>
            </div>
            <!--Creating the form element with input type range to select salary(UC4)-->
            <div class="row-content">
                <label class="label text label-bold" for="salary">Salary</label>
                <input class="input input-salary" @bind="@employee.Salary" type="number" defaultvalue="360000" min="200000" max="800000" step="1000" required>
                <error class="error" id="errorName"></error>
            </div>
            <!--Creating the form element with select to select day, month and year(UC5)-->
            <div class="row-content">
                <label class="label text label-bold" for="startDate">Start Date</label>
                <input class="input input-salary" @bind="@employee.StartDate" type="date" placeholder="" s />
                <error id="errorDate" class="error errorDate" name="errorDate"></error>
            </div>
            <!--Creating the form element with notes and buttons(UC6)-->
            <div class="row-content">
                <label class="label text label-bold" for="notes">Notes</label>
                <textarea rows="4" class="input" @bind="@employee.Notes" placeholder="Enter Any Notes or Comments here" id="notes" style="height: 100px;" required></textarea>
            </div>
            <div class="button_container">
                <div class="buttons">
                    <button type="submit" @onclick="@UpdateEmployee" class="submit_button button" id="submitButton">Update</button>
                    <button type="reset" @onclick="@Cancel" class="cancel_button button">Cancel</button>
                </div>
                <MatSnackbar @bind-IsOpen="@snackBarCancel">
                    <a href="HomePage">
                        <MatSnackbarContent>Click To Return To Home Page...!!!</MatSnackbarContent>
                    </a>
                </MatSnackbar>
                <MatSnackbar @bind-IsOpen="@snackBarUpdate">
                    <a href="HomePage">
                        <MatSnackbarContent>Updated The Employee Successfully...!!!</MatSnackbarContent>
                    </a>
                </MatSnackbar>
            </div>
        </EditForm>
    </form>
</div>


@code {
    bool snackBarUpdate = false;
    bool snackBarCancel = false;
    EmployeeModel employee = new EmployeeModel();
    protected void AddImg(string img)
    {
        employee.ProfileImg = img;
    }

    protected void UpdateEmployee()
    {
        employeeBL.UpdateEmployee(employee);
        snackBarUpdate = true;
        this.StateHasChanged();
    }

    [Parameter]
    public string EmployeeId { get; set; }

    protected override async Task OnInitializedAsync()
    {
        employee = await Task.Run(() => employeeBL.GetEmployee(Convert.ToInt32(EmployeeId)));
    }

    void Cancel()
    {
        snackBarCancel = true;
        this.StateHasChanged();
    }

    void GoBack()
    {
        //Thread.Start(1000);
        navigate.NavigateTo("HomePage");
    }
}